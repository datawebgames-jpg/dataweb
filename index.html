<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DATAWEB Asesoramientos</title>
  <meta name="description" content="DATAWEB Asesoramientos ‚Äî tr√°mites, ciudadan√≠as, gestiones, pagos y asesoramiento tecnol√≥gico. Consultas por email o WhatsApp. Noticias y clima locales." />

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="DATAWEB Asesoramientos" />
  <meta property="og:description" content="Consult√° online sobre ciudadan√≠as, tr√°mites, pagos y tecnolog√≠a. Te ayudamos a simplificar tus gestiones." />
  <meta property="og:url" content="https://datawebgames-jpg.github.io/dataweb/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://datawebgames-jpg.github.io/dataweb/assets/dataweb-banner.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="icon" href="favicon.png" />

  <!-- Facebook SDK (Like + Share plugin) -->
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/es_LA/sdk.js#xfbml=1&version=v17.0" nonce="fb"></script>

  <!-- EmailJS -->
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>

  <!-- Styles (single file) -->
  <style>
    :root{
      --bg1:#01204a; --bg2:#0d4da0; --card:#ffffff; --text:#05213f;
      --muted:#6b7a90; --primary:#1e5fb3; --accent:#25D366;
      --success-bg:#e6f7ee; --success-border:#2fa66a;
    }
    @media (prefers-color-scheme: dark){
      :root{ --card:#071428; --text:#dff1ff; --muted:#9fb6d0; --primary:#4ea0ff }
    }
    *{box-sizing:border-box}
    body{ margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; color:var(--text); background:linear-gradient(180deg,#ecf6ff 0%,#fbfdff 100%); -webkit-font-smoothing:antialiased; }

    /* HERO */
    .hero { position:relative; overflow:hidden; background: linear-gradient(180deg,var(--bg1),var(--bg2)); color:#fff; padding:44px 16px 88px; text-align:center; }
    .hero h1{ margin:0; font-size:2rem; letter-spacing:1px }
    .hero p{ margin:10px 0 0 0; opacity:0.95; font-size:1.05rem }

    .waves { position:absolute; left:0; right:0; bottom:-1px; height:160px; pointer-events:none;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="160" viewBox="0 0 1600 160"><path fill="%23ffffff" fill-opacity="0.06" d="M0 80 C200 40 400 120 600 80 C800 40 1000 120 1200 80 C1400 40 1600 120 1600 120 L1600 160 L0 160 Z"/></svg>') repeat-x;
      animation: waveMove 18s linear infinite; opacity:0.9;
    }
    @keyframes waveMove{ from{transform:translateX(0)} to{transform:translateX(-50%)} }

    .container{ max-width:1200px; margin:-60px auto 40px; padding:0 14px; }

    main{ display:grid; grid-template-columns:2fr 1fr; gap:16px; align-items:start; }
    @media (max-width:980px){ main{ grid-template-columns:1fr } }

    .card{ background:var(--card); border-radius:12px; padding:14px; box-shadow:0 8px 26px rgba(12,36,78,0.06); margin-bottom:14px; }
    h2{ margin:0 0 10px 0; color:var(--primary) }
    p.muted{ margin:0; color:var(--muted) }
    .muted-small{ font-size:0.9rem; color:var(--muted) }

    .services{ display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:10px; margin-top:10px; }
    .svc{ background:linear-gradient(180deg,#fff,#fbfdff); border-radius:8px; padding:10px; border:1px solid rgba(30,95,179,0.06) }

    form{ display:flex; flex-direction:column; gap:10px }
    input,textarea,select{ padding:10px; border-radius:8px; border:1px solid #d6e3ff; background:#fff; color:var(--text); font-size:1rem }
    textarea{ min-height:110px; resize:vertical }
    .btn{ background:var(--primary); color:#fff; padding:10px; border-radius:8px; border:0; font-weight:700; cursor:pointer }
    .btn.secondary{ background:#f1f5fb; color:var(--primary); border:1px solid rgba(30,95,179,0.08) }

    /* icon selector */
    .icon-selector{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    .icon-btn{
      display:flex; gap:8px; align-items:center; padding:8px 10px; border-radius:10px; background:#fff; border:1px solid rgba(0,0,0,0.06);
      cursor:pointer; user-select:none; transition:transform .14s, box-shadow .14s;
    }
    .icon-btn.active{ outline:3px solid rgba(30,95,179,0.12); transform:translateY(-3px); box-shadow:0 10px 30px rgba(30,95,179,0.08); }

    /* whatsapp floating animated */
    .whatsapp-float {
      position: fixed; width:64px; height:64px; bottom:18px; right:18px; background:var(--accent); color:#fff; border-radius:50%;
      display:flex; align-items:center; justify-content:center; font-size:28px; text-decoration:none; z-index:1200; box-shadow:0 12px 24px rgba(2,62,12,0.18);
      animation: wobble 2.6s infinite ease-in-out;
    }
    @keyframes wobble { 0%{transform:translateY(0)}25%{transform:translateY(-6px)}50%{transform:translateY(0)}75%{transform:translateY(-4px)}100%{transform:translateY(0)} }
    .whatsapp-float:hover{ transform:scale(1.08) }

    /* Like area */
    .fb-like-wrap{ display:flex; flex-direction:column; align-items:center; gap:8px }

    /* Modal (thank you) */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(2,12,28,0.5); display:none; align-items:center; justify-content:center; z-index:1400;
    }
    .modal{
      width:90%; max-width:420px; background:var(--card); border-radius:12px; padding:20px; text-align:center; box-shadow:0 20px 50px rgba(2,12,28,0.4);
      transform:translateY(20px); opacity:0; transition:all .32s ease;
    }
    .modal.show{ transform:none; opacity:1; }
    .modal .ok{
      width:52px; height:52px; border-radius:50%; background:var(--success-bg); display:inline-flex; align-items:center; justify-content:center; border:2px solid var(--success-border); font-size:22px; margin-bottom:12px;
    }
    .modal h3{ margin:0 0 8px 0 }
    .modal p{ margin:0 0 12px 0; color:var(--muted) }

    footer{ text-align:center; color:var(--muted); padding:20px 0; margin-top:20px }

    .cta-buy{ margin-top:12px; background:linear-gradient(90deg,var(--primary),#0a55a8); color:white; padding:14px; border-radius:10px; text-align:center }

    .top-bar{ width:100%; background:linear-gradient(90deg,var(--primary),#4aa3ff 60%, #ffffff); color:white; padding:6px 0; overflow:hidden; position:relative; font-weight:600; font-size:0.95rem; text-align:center;}
    .top-bar span{ position:relative; display:inline-block }

    @media (max-width:480px){
      .hero{ padding:28px 12px 70px }
    }
  </style>
</head>
<body>

  <div class="top-bar"><span>‚ú® Asesoramiento online ‚Ä¢ Tr√°mites ‚Ä¢ Ciudadan√≠as ‚Ä¢ Tecnolog√≠a ‚Ä¢ Compras seguras y tasaciones ‚ú®</span></div>

  <header class="hero" role="banner">
    <div class="waves" aria-hidden="true"></div>
    <h1>DATAWEB Asesoramientos</h1>
    <p>En DATAWEB queremos hacerte la vida m√°s simple. Dej√° que nosotros nos encarguemos de los tr√°mites.</p>
  </header>

  <div class="container">
    <main>
      <!-- LEFT -->
      <div>
        <section class="card" id="intro">
          <h2>Servicios</h2>
          <p class="muted-small">Tr√°mites, ciudadan√≠as, pagos, gestor√≠as, asesoramiento tecnol√≥gico y m√°s. Te ayudamos a ahorrar tiempo.</p>
          <div class="services" aria-label="Servicios">
            <div class="svc"><strong>Ciudadan√≠as</strong><p class="muted-small">Espa√±ola e Italiana ‚Äî armado de carpetas IDU.</p></div>
            <div class="svc"><strong>Gestor√≠a</strong><p class="muted-small">Automotor, municipal e impuestos.</p></div>
            <div class="svc"><strong>Pagos</strong><p class="muted-small">Pago de facturas y gesti√≥n administrativa.</p></div>
            <div class="svc"><strong>Tecnolog√≠a</strong><p class="muted-small">Asesoramiento en compra de equipos e insumos.</p></div>
          </div>
        </section>

        <section class="card" id="contact-section">
          <h2>Consultas y Asesoramientos</h2>
          <p class="muted-small">Eleg√≠ el tipo de tr√°mite tocando el icono, complet√° tus datos y eleg√≠ c√≥mo quer√©s que te respondamos.</p>

          <div id="general-confirm" class="confirm" role="status" aria-live="polite"></div>

          <!-- Icon selector -->
          <div class="icon-selector" id="iconSelector" aria-hidden="false" style="margin-bottom:8px">
            <div class="icon-btn" data-val="ARBA" title="ARBA">üèõÔ∏è <span style="font-weight:600;margin-left:6px">ARBA</span></div>
            <div class="icon-btn" data-val="Municipal" title="Municipal">üßæ <span style="font-weight:600;margin-left:6px">Municipal</span></div>
            <div class="icon-btn" data-val="Gestor√≠a Automotor" title="Gestor√≠a Automotor">üöó <span style="font-weight:600;margin-left:6px">Gestor√≠a</span></div>
            <div class="icon-btn" data-val="Ciudadan√≠a" title="Ciudadan√≠a">ü™™ <span style="font-weight:600;margin-left:6px">Ciudadan√≠a</span></div>
            <div class="icon-btn" data-val="Otros" title="Otros">‚ûï <span style="font-weight:600;margin-left:6px">Otros</span></div>
          </div>

          <!-- Main form -->
          <form id="general-form" onsubmit="return false;">
            <label for="g-service">Tipo (seleccion√° el icono o eleg√≠ manualmente)</label>
            <select id="g-service" name="service_type" required>
              <option value="Formulario General">Consulta general</option>
              <option value="ARBA">ARBA</option>
              <option value="Municipal">Municipal</option>
              <option value="Gestor√≠a Automotor">Gestor√≠a Automotor</option>
              <option value="Ciudadan√≠a">Ciudadan√≠a</option>
              <option value="Otros">Otros</option>
            </select>

            <input id="g-name" name="user_name" type="text" placeholder="Tu nombre completo" required />
            <input id="g-email" name="user_email" type="email" placeholder="Tu correo electr√≥nico" required />
            <input id="g-whatsapp" name="user_whatsapp" type="text" placeholder="Tu WhatsApp (ej: +5492954...)" />
            <textarea id="g-message" name="user_message" placeholder="Contanos en qu√© te podemos ayudar..." required></textarea>

            <label for="g-method">¬øC√≥mo prefer√≠s que te respondamos?</label>
            <select id="g-method" name="g-method">
              <option value="email">Por correo electr√≥nico</option>
              <option value="whatsapp">Por WhatsApp</option>
            </select>

            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
              <button type="button" id="sendBtn" class="btn">Enviar consulta</button>
              <button type="button" id="clearBtn" class="btn secondary">Limpiar</button>
            </div>
          </form>
        </section>

        <section class="card" id="local-news-section">
          <h2>Noticias de tu zona</h2>
          <div id="news-list"><p class="muted">Detectando ubicaci√≥n para mostrar noticias regionales...</p></div>
        </section>
      </div>

      <!-- RIGHT -->
      <aside>
        <div class="card small clima">
          <h3 style="margin:0 0 8px 0">üå§Ô∏è Clima local</h3>
          <div id="clima-content"><p class="muted">Obteniendo clima...</p></div>
        </div>

        <div class="card small">
          <h3 style="margin:0 0 8px 0">üíµ D√≥lar hoy (Argentina)</h3>
          <div class="kpi"><div class="left">Oficial</div><div id="d-oficial" class="right">Cargando...</div></div>
          <div class="kpi" style="margin-top:8px"><div class="left">Blue</div><div id="d-blue" class="right">Cargando...</div></div>
          <div style="margin-top:8px"><a class="muted-small" href="https://www.dolarhoy.com/" target="_blank" rel="noopener">Ver tabla completa</a></div>
        </div>

        <div class="card tweets">
          <h3 style="margin:0 0 8px 0">üê¶ √öltimos Tweets</h3>
          <div style="display:flex;flex-direction:column;gap:6px">
            <a href="https://twitter.com/lanacion" target="_blank">@LANACION</a>
            <a href="https://twitter.com/clarincom" target="_blank">@clarincom</a>
          </div>
          <div style="margin-top:8px" class="muted-small">Para timelines embebidos activ√° widgets X en producci√≥n.</div>
        </div>

        <div class="card small">
          <h3 style="margin:0 0 8px 0">üí¨ Consultas R√°pidas</h3>
          <p class="muted-small" style="margin:0 0 8px 0">Eleg√≠ un tipo y dej√° tu mail/WhatsApp. Te respondemos con tarifa estimada.</p>

          <div class="quick-icons" id="quick-icons">
            <div class="quick-icon" data-type="ARBA">üèõÔ∏è <div style="font-weight:600">ARBA</div></div>
            <div class="quick-icon" data-type="Municipal">üßæ <div style="font-weight:600">Municipal</div></div>
            <div class="quick-icon" data-type="Gestor√≠a Automotor">üöó <div style="font-weight:600">Gestor√≠a</div></div>
            <div class="quick-icon" data-type="Ciudadan√≠a">ü™™ <div style="font-weight:600">Ciudadan√≠a</div></div>
          </div>

          <div id="quick-confirm" class="confirm"></div>

          <form id="quick-form">
            <input type="hidden" id="quick-type" name="service_type" value="">
            <input id="quick-email" name="user_email" type="email" placeholder="Tu correo electr√≥nico" required>
            <input id="quick-whatsapp" name="user_whatsapp" type="text" placeholder="Tu WhatsApp (opcional)">
            <textarea id="quick-message" name="user_message" placeholder="Mensaje breve (opcional)"></textarea>
            <button class="btn" type="submit">Enviar consulta r√°pida</button>
          </form>
        </div>

        <div class="card small">
          <h3 style="margin:0 0 8px 0">¬øTe gusta DATAWEB?</h3>
          <div class="fb-like-wrap">
            <!-- Facebook Like + Share plugin (contador real) -->
            <div class="fb-like" data-href="https://www.facebook.com/AsesoramientosPampa" data-width="" data-layout="standard" data-action="like" data-size="large" data-share="true"></div>
            <div class="muted-small">Dale like a nuestra p√°gina y compart√≠.</div>
          </div>
        </div>

        <div class="card small social">
          <h3 style="margin:0 0 8px 0">Compartir</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn secondary" onclick="copiarLinkInstagram()">üìã Copiar enlace para Instagram</button>
            <a class="btn secondary" href="https://www.facebook.com/sharer/sharer.php?u=https://datawebgames-jpg.github.io/dataweb/" target="_blank" rel="noopener">üîó Compartir en Facebook</a>
          </div>
        </div>
      </aside>
    </main>

    <!-- CTA compras / tasaci√≥n -->
    <div style="max-width:1200px;margin:18px auto;padding:0 14px">
      <div class="cta-buy card">
        <h3 style="margin:0 0 8px 0">üõçÔ∏è Compras seguras o tasaci√≥n</h3>
        <p style="margin:0 0 12px 0">Te ayudamos a comprar con seguridad o a valorar tus productos. Eleg√≠ una opci√≥n y dej√° tu contacto.</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
          <button class="btn" onclick="ctaConsulta('Compras Seguras')">üõí Compras seguras</button>
          <button class="btn" onclick="ctaConsulta('Tasaci√≥n / Venta')">üí∞ Tasaci√≥n / Vender</button>
        </div>
      </div>
    </div>

    <footer>¬© 2025 DATAWEB ‚Ä¢ Asesoramientos ‚Ä¢ ‚úâÔ∏è dataweb76@gmail.com ‚Ä¢ üì± +54 2954 320639</footer>
  </div>

  <!-- WhatsApp floating (animated) -->
  <a class="whatsapp-float"
     id="waFloat"
     href="https://wa.me/5492954320639?text=Hola%2C%20vi%20la%20p√°gina%20DATAWEB%20y%20quiero%20hacer%20una%20consulta."
     target="_blank" rel="noopener" aria-label="WhatsApp">
    üí¨
  </a>

  <!-- Modal (thank you) -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="thankModal" aria-labelledby="modalTitle">
      <div class="ok">‚úÖ</div>
      <h3 id="modalTitle">¬°Gracias por consultarnos!</h3>
      <p>En breve te responderemos tu mensaje por el medio seleccionado.</p>
      <button class="btn" onclick="closeModal()">Aceptar</button>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Init EmailJS with your public key
    (function(){ if(window.emailjs) emailjs.init('s4mg-ltaKMlUUoXhb'); })();

    (function(){
      const SERVICE_ID = 'service_bliy8jc';
      const TEMPLATE_ID = 'template_zr5w5se';

      /* Helper: show small inline confirm (fallback) */
      function showConfirmInline(el, text, ok){
        el.style.display = 'block';
        el.textContent = text;
        if(ok){ el.style.background = 'var(--success-bg)'; el.style.border = '1px solid var(--success-border)'; }
        else { el.style.background = '#fff0f0'; el.style.border = '1px solid #e35b5b'; }
        setTimeout(()=> el.style.display='none', 7000);
      }

      /* Modal control */
      const modalBackdrop = document.getElementById('modalBackdrop');
      const thankModal = document.getElementById('thankModal');
      function openModal(){
        modalBackdrop.style.display = 'flex';
        setTimeout(()=> { thankModal.classList.add('show'); modalBackdrop.setAttribute('aria-hidden','false'); }, 20);
      }
      window.closeModal = function(){
        thankModal.classList.remove('show');
        modalBackdrop.setAttribute('aria-hidden','true');
        setTimeout(()=> modalBackdrop.style.display='none', 300);
      };

      /* ICON SELECTOR behavior */
      const iconButtons = document.querySelectorAll('.icon-btn');
      const selectService = document.getElementById('g-service');
      iconButtons.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          iconButtons.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const v = btn.getAttribute('data-val');
          for(const opt of selectService.options){
            if(opt.value === v){ selectService.value = v; break; }
          }
        });
      });

      /* MAIN FORM */
      const sendBtn = document.getElementById('sendBtn');
      const clearBtn = document.getElementById('clearBtn');
      const genConfirm = document.getElementById('general-confirm');

      sendBtn.addEventListener('click', async function(){
        const method = document.getElementById('g-method').value;
        const service_type = document.getElementById('g-service').value;
        const name = document.getElementById('g-name').value.trim();
        const email = document.getElementById('g-email').value.trim();
        const whatsapp = document.getElementById('g-whatsapp').value.trim();
        const message = document.getElementById('g-message').value.trim();

        if(!name || !email || !message){
          showConfirmInline(genConfirm, 'Por favor complet√° nombre, correo y mensaje.', false);
          return;
        }

        if(method === 'email'){
          const params = {
            service_type: service_type,
            user_name: name,
            user_email: email,
            user_whatsapp: whatsapp || 'No provisto',
            user_message: message,
            to_email: 'dataweb76@gmail.com'
          };
          try{
            await emailjs.send(SERVICE_ID, TEMPLATE_ID, params);
            openModal(); // modal confirmation
            document.getElementById('general-form').reset();
            iconButtons.forEach(b=>b.classList.remove('active'));
          }catch(err){
            console.error('EmailJS error', err);
            showConfirmInline(genConfirm, '‚ö†Ô∏è No se pudo enviar por correo. Intent√° por WhatsApp.', false);
          }
        } else {
          const pre = `¬°Hola! Quiero hacer una consulta desde la web de DATAWEB.%0A%0ATipo:%20${encodeURIComponent(service_type)}%0ANombre:%20${encodeURIComponent(name)}%0AEmail:%20${encodeURIComponent(email)}%0AWhatsApp:%20${encodeURIComponent(whatsapp)}%0A%0AMensaje:%20${encodeURIComponent(message)}`;
          const waUrl = `https://wa.me/5492954320639?text=${pre}`;
          window.open(waUrl, '_blank');
          openModal();
          document.getElementById('general-form').reset();
          iconButtons.forEach(b=>b.classList.remove('active'));
        }
      });

      clearBtn.addEventListener('click', ()=> {
        document.getElementById('general-form').reset();
        iconButtons.forEach(b=>b.classList.remove('active'));
      });

      /* QUICK FORM */
      document.querySelectorAll('.quick-icon').forEach(icon=>{
        icon.addEventListener('click', ()=> {
          const t = icon.getAttribute('data-type');
          document.getElementById('quick-type').value = t;
          icon.style.boxShadow = '0 10px 30px rgba(30,95,179,0.12)';
          setTimeout(()=> icon.style.boxShadow = '', 900);
          document.getElementById('quick-email').focus();
        });
      });

      const quickForm = document.getElementById('quick-form');
      const quickConfirm = document.getElementById('quick-confirm');
      quickForm.addEventListener('submit', function(e){
        e.preventDefault();
        const tipo = document.getElementById('quick-type').value || 'Consulta R√°pida';
        const email = document.getElementById('quick-email').value.trim();
        const whatsapp = document.getElementById('quick-whatsapp').value.trim();
        const message = document.getElementById('quick-message').value.trim() || 'Sin mensaje adicional';
        if(!email){ showConfirmInline(quickConfirm, 'Por favor ingres√° tu correo electr√≥nico.', false); return; }
        const params = { service_type: tipo, user_email: email, user_whatsapp: whatsapp || 'No provisto', user_message: message, to_email: 'dataweb76@gmail.com' };
        emailjs.send(SERVICE_ID, TEMPLATE_ID, params).then(()=> {
          showConfirmInline(quickConfirm, '‚úÖ Tu consulta fue enviada. Te responderemos pronto.', true);
          quickForm.reset();
          document.getElementById('quick-type').value = '';
        }, (err)=> { console.error(err); showConfirmInline(quickConfirm, '‚ö†Ô∏è No se pudo enviar. Intent√° por WhatsApp.', false); });
      });

      /* CTA buttons (Compras / Tasaci√≥n) */
      window.ctaConsulta = function(tipo){
        const email = prompt('Ingres√° tu correo para que te contactemos acerca de: ' + tipo);
        if(!email){ alert('No se envi√≥ la consulta: se requiere correo.'); return; }
        const params = { service_type: tipo, user_email: email, user_whatsapp: 'No provisto', user_message: 'Consulta v√≠a CTA: ' + tipo, to_email: 'dataweb76@gmail.com' };
        emailjs.send(SERVICE_ID, TEMPLATE_ID, params).then(()=> alert('‚úÖ Consulta enviada. Te contactamos por mail o WhatsApp.'), (err)=> { console.error(err); alert('Error al enviar.'); });
      };

      /* copy link for Instagram (exact) */
      window.copiarLinkInstagram = function(){
        const url = 'https://datawebgames-jpg.github.io/dataweb/';
        navigator.clipboard.writeText(url).then(()=> alert('Enlace copiado: pegalo en tu historia o biograf√≠a de Instagram.\n' + url));
      };

      /* D√≥lar (attempt) */
      (function loadDolar(){
        const oEl = document.getElementById('d-oficial');
        const bEl = document.getElementById('d-blue');
        fetch('https://api.bluelytics.com.ar/v2/latest').then(r=>r.json()).then(data=>{
          if(data){
            const of = data.oficial || {}; const blue = data.blue || {};
            const ofVal = of.value_sell || of.value || '‚Äî'; const blueVal = blue.value_sell || blue.value || '‚Äî';
            if(oEl) oEl.textContent = (typeof ofVal === 'number') ? ofVal.toFixed(2) : ofVal;
            if(bEl) bEl.textContent = (typeof blueVal === 'number') ? blueVal.toFixed(2) : blueVal;
          }
        }).catch(()=>{ if(oEl) oEl.innerHTML = '<a href="https://www.dolarhoy.com/" target="_blank">Ver</a>'; if(bEl) bEl.innerHTML = '<a href="https://www.dolarhoy.com/" target="_blank">Ver</a>'; });
      })();

      /* GEOLOCATION -> WEATHER & RSS */
      const regionalFeeds = {
        'LA PAMPA': ['https://www.laarena.com.ar/rss'],
        'BUENOS AIRES': ['https://www.clarin.com/rss/lo-ultimo/'],
        'CABA': ['https://www.lanacion.com.ar/arc/outboundfeeds/rss/?outputType=xml'],
        'CORDOBA': ['https://www.lavoz.com.ar/rss/lo-ultimo.xml'],
        'MENDOZA': ['https://www.losandes.com.ar/rss/'],
        'SANTA FE': ['https://www.ellitoral.com/rss/ultimas.xml'],
        'RIO NEGRO': ['https://www.rionegro.com.ar/feed/'],
        'NEUQUEN': ['https://www.lmneuquen.com/rss.xml'],
        'TUCUMAN': ['https://www.lagaceta.com.ar/rss/ultimas.xml'],
        'SALTA': ['https://www.eltribuno.com/salta/rss/ultimas.xml'],
        'MISIONES': ['https://www.elterritorio.com.ar/rss'],
        'CORRIENTES': ['https://www.diarioepoca.com/rss'],
        'CHACO': ['https://www.diarionorte.com/rss'],
        'DEFAULT_AR': ['https://www.infobae.com/rss/'],
        'SPAIN_DEFAULT': ['https://feeds.elpais.com/rss/elpais/portada']
      };

      async function locate(){
        return new Promise(resolve=>{
          if(navigator.geolocation){
            navigator.geolocation.getCurrentPosition(pos=> resolve({latitude: pos.coords.latitude, longitude: pos.coords.longitude, city: ''}), async ()=>{
              try{ const r = await (await fetch('https://ipapi.co/json/')).json(); resolve(r); }catch(e){ resolve(null); }
            }, {timeout:8000});
          } else { fetch('https://ipapi.co/json/').then(r=>r.json()).then(j=>resolve(j)).catch(()=>resolve(null)); }
        });
      }

      async function fetchRSS(feedUrl){
        try{ const proxy = 'https://api.allorigins.win/raw?url='; const res = await fetch(proxy + encodeURIComponent(feedUrl)); if(!res.ok) throw new Error('no ok'); const txt = await res.text(); const doc = new DOMParser().parseFromString(txt,'application/xml'); return doc; }catch(e){ console.warn('RSS fetch error', e); return null; }
      }

      function parseRSStoItems(xmlDoc, maxItems=5){
        if(!xmlDoc) return [];
        const items = Array.from(xmlDoc.querySelectorAll('item')).slice(0,maxItems);
        if(items.length===0){
          const entries = Array.from(xmlDoc.querySelectorAll('entry')).slice(0,maxItems);
          return entries.map(en => ({ title: en.querySelector('title') ? en.querySelector('title').textContent : 'Sin t√≠tulo', link: (en.querySelector('link') ? (en.querySelector('link').getAttribute('href')||en.querySelector('link').textContent) : '#') }));
        }
        return items.map(it => ({ title: it.querySelector('title') ? it.querySelector('title').textContent : 'Sin t√≠tulo', link: it.querySelector('link') ? (it.querySelector('link').textContent || it.querySelector('link').getAttribute('href')) : '#' }));
      }

      function selectFeeds(meta){
        if(!meta) return regionalFeeds['DEFAULT_AR'];
        const country = (meta.country || meta.country_code || '').toString().toUpperCase();
        const region = (meta.region || meta.region_name || '').toString().toUpperCase();
        if(country === 'AR' || country === 'ARGENTINA'){
          for(const key of Object.keys(regionalFeeds)) if(key === region || region.includes(key) || key.includes(region)) return regionalFeeds[key];
          return regionalFeeds['DEFAULT_AR'];
        }
        if(country === 'ES' || country === 'SPAIN' || (meta.country_name && meta.country_name.toUpperCase().includes('ESPA√ëA'))) return regionalFeeds['SPAIN_DEFAULT'];
        return ['https://news.google.com/rss'];
      }

      async function showNewsFor(meta){
        const target = document.getElementById('news-list');
        target.innerHTML = '<p class="muted">Cargando noticias...</p>';
        const feeds = selectFeeds(meta);
        let collected = [];
        for(const f of feeds){
          const xml = await fetchRSS(f);
          const items = parseRSStoItems(xml,5);
          if(items && items.length){ collected = items; break; }
        }
        if(collected.length){
          target.innerHTML = '<ul style="padding-left:18px;margin:6px 0">' + collected.map(it => `<li style="margin-bottom:8px"><a href="${it.link}" target="_blank" rel="noopener">${it.title}</a></li>`).join('') + '</ul>';
        } else {
          target.innerHTML = '<p class="muted">No se encontraron titulares regionales. Mostrando noticias nacionales.</p><p><a href="https://www.infobae.com" target="_blank">Infobae</a> ‚Ä¢ <a href="https://www.clarin.com" target="_blank">Clar√≠n</a> ‚Ä¢ <a href="https://www.lanacion.com.ar" target="_blank">La Naci√≥n</a></p>';
        }
      }

      async function showWeather(lat, lon, cityName){
        const el = document.getElementById('clima-content');
        el.innerHTML = '<p class="muted">Obteniendo clima...</p>';
        try{
          const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`;
          const r = await fetch(url);
          const j = await r.json();
          if(j && j.current_weather){
            const cw = j.current_weather;
            el.innerHTML = `<div style="font-weight:700">${cityName || ''}</div><div style="font-size:1.6rem;font-weight:700;margin-top:6px">${cw.temperature}¬∞C</div><div class="muted-small" style="margin-top:6px">Viento: ${cw.windspeed} km/h ‚Ä¢ C√≥digo: ${cw.weathercode}</div><div style="margin-top:8px"><a class="muted-small" href="https://open-meteo.com/" target="_blank">Fuente: Open-Meteo</a></div>`;
            return;
          }
        }catch(e){ console.warn('weather error', e); }
        el.innerHTML = '<p class="muted">No se pudo obtener el clima.</p>';
      }

      (async function init(){
        const loc = await locate();
        if(!loc){
          showWeather(-36.6167, -64.2833, 'Santa Rosa (La Pampa)');
          showNewsFor({country:'AR', region:'LA PAMPA', city:'Santa Rosa'});
          return;
        }
        const lat = loc.latitude || loc.lat || loc.latitude;
        const lon = loc.longitude || loc.lon || loc.longitude;
        const city = loc.city || loc.city || loc.city || '';
        const region = loc.region || loc.region || loc.region || '';
        const country = loc.country || loc.country_code || loc.country || '';

        if(lat && lon) showWeather(lat, lon, city || region);
        else { try{ const ipj = await (await fetch('https://ipapi.co/json/')).json(); showWeather(ipj.latitude, ipj.longitude, ipj.city || ipj.region); }catch(e){ showWeather(-36.6167, -64.2833, 'Santa Rosa (La Pampa)'); } }

        const meta = { city: city, region: region, country: country, country_name: loc.country_name || '' };
        showNewsFor(meta);
      })();

    })();
  </script>
</body>
</html>










